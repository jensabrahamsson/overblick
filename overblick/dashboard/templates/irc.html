{% extends "base.html" %}
{% block title %}IRC{% endblock %}

{% block content %}
<div class="irc-page irc-layout">

    <!-- Sidebar: channel list -->
    <aside class="irc-sidebar" role="navigation" aria-label="IRC conversations">
        <h2 class="irc-sidebar-title">
            Channels
        </h2>

        {% if not conversations %}
        <p class="irc-sidebar-empty">
            No conversations yet.
        </p>
        {% else %}
        <ul class="irc-sidebar-list" role="list">
            {% for conv in conversations %}
            <li>
                <a href="/irc?id={{ conv.id }}"
                   class="irc-sidebar-item {% if conv.id == selected_id %}irc-sidebar-item--active{% endif %}"
                   {% if conv.id == selected_id %}aria-current="true"{% endif %}>
                    <div class="irc-sidebar-channel">
                        {{ conv.channel or conv.topic[:20] }}
                    </div>
                    <div class="irc-sidebar-topic">{{ conv.topic }}</div>
                    <div class="irc-sidebar-meta">
                        <span>{{ conv.participants | length }} users</span>
                        <span class="badge-state badge-state--{{ conv.state if conv.state in ['active', 'paused', 'completed'] else 'error' }}">{{ conv.state }}</span>
                    </div>
                </a>
            </li>
            {% endfor %}
        </ul>
        {% endif %}
    </aside>

    <!-- Main: conversation view -->
    <section class="irc-main irc-main-content">

        {% if selected %}
        <!-- Channel header bar -->
        <div class="irc-header">
            <span class="irc-header-channel">{{ selected.channel or '#general' }}</span>
            <span class="irc-header-topic">{{ selected.topic }}</span>
            <span class="irc-header-meta">
                {% for name in selected.participants %}
                <span style="color: {{ color_map.get(name, 'var(--text-muted)') }};">{{ name }}</span>{% if not loop.last %}, {% endif %}
                {% endfor %}
                &nbsp;|&nbsp;{{ selected.turns | length }} msgs
                {% if selected.state == 'paused' %}
                &nbsp;|&nbsp;<span class="irc-paused-label">PAUSED</span>
                {% endif %}
            </span>
        </div>

        <!-- IRC feed (htmx-polled) -->
        <div id="irc-feed"
             class="irc-log irc-feed-container"
             role="log"
             aria-live="polite"
             aria-label="IRC conversation feed"
             {% if selected.state == 'active' %}
             hx-get="/irc/feed?id={{ selected.id }}"
             hx-trigger="every 3s"
             hx-swap="innerHTML settle:150ms"
             {% endif %}>
            {% include "partials/irc_feed.html" with context %}
        </div>

        {% else %}
        <!-- Empty state -->
        <div class="irc-empty-state">
            <div>
                <p class="irc-empty-text">
                    No IRC conversations yet
                </p>
                <p class="irc-empty-hint">
                    Identity conversations start automatically when system load is low.
                </p>
            </div>
        </div>
        {% endif %}

    </section>
</div>

{% endblock %}
