{% extends "onboarding/layout.html" %}

{% block wizard_content %}
<h2 class="wizard-title">LLM Configuration</h2>
<p class="wizard-desc">Configure the language model settings for this identity.</p>

{% if error %}
<div class="flash flash-error" role="alert">{{ error }}</div>
{% endif %}

<form method="post" action="/onboard" class="wizard-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="step" value="2">

    {% set llm = wizard.get('llm', {}) %}
    {% set current_provider = llm.get('provider', 'ollama') %}

    <div class="form-group">
        <label for="model" class="form-label">Model</label>
        <input type="text" id="model" name="model" class="form-input"
               value="{{ llm.get('model', 'qwen3:8b') }}" required>
        <span class="form-hint">Ollama model name (e.g. qwen3:8b, llama3:8b, mistral:7b).</span>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="temperature" class="form-label">Temperature</label>
            <input type="number" id="temperature" name="temperature" class="form-input"
                   step="0.1" min="0" max="2"
                   value="{{ llm.get('temperature', 0.7) }}">
            <span class="form-hint">0.0 = deterministic, 2.0 = maximum randomness.</span>
        </div>

        <div class="form-group">
            <label for="max_tokens" class="form-label">Max Tokens</label>
            <input type="number" id="max_tokens" name="max_tokens" class="form-input"
                   min="100" max="8000" step="100"
                   value="{{ llm.get('max_tokens', 2000) }}">
        </div>
    </div>

    <div class="form-group">
        <label class="form-label">Provider</label>
        <div class="radio-group">
            <label class="form-radio">
                <input type="radio" name="provider" value="ollama"
                       {% if current_provider == 'ollama' %}checked{% endif %}
                       onchange="switchProvider('ollama')">
                <span>Ollama (Local)</span>
            </label>
            <label class="form-radio">
                <input type="radio" name="provider" value="gateway"
                       {% if current_provider == 'gateway' %}checked{% endif %}
                       onchange="switchProvider('gateway')">
                <span>LLM Gateway</span>
            </label>
            <label class="form-radio">
                <input type="radio" name="provider" value="cloud"
                       {% if current_provider == 'cloud' %}checked{% endif %}
                       onchange="switchProvider('cloud')">
                <span>Cloud LLM</span>
            </label>
        </div>
        <span class="form-hint">Ollama runs locally. Gateway adds priority queuing. Cloud connects to external APIs.</span>
    </div>

    <div id="cloud-config" style="display: {{ 'block' if current_provider == 'cloud' else 'none' }};">
        <div class="form-group">
            <label for="cloud_api_url" class="form-label">API URL</label>
            <input type="text" id="cloud_api_url" name="cloud_api_url" class="form-input"
                   value="{{ llm.get('cloud_api_url', '') }}"
                   placeholder="https://api.openai.com/v1">
            <span class="form-hint">Base URL for the cloud provider API.</span>
        </div>
        <div class="form-group">
            <label for="cloud_model" class="form-label">Cloud Model Name</label>
            <input type="text" id="cloud_model" name="cloud_model" class="form-input"
                   value="{{ llm.get('cloud_model', '') }}"
                   placeholder="gpt-4o">
            <span class="form-hint">The API key will be configured as an encrypted secret.</span>
        </div>
    </div>

    <div class="wizard-actions">
        <a href="/onboard?step=1" class="btn btn-ghost">Back</a>
        <button type="submit" class="btn btn-primary">Next: Personality</button>
    </div>
</form>

<script>
function switchProvider(provider) {
    document.getElementById('cloud-config').style.display = provider === 'cloud' ? 'block' : 'none';
}
</script>
{% endblock %}
