{% extends "base.html" %}
{% block title %}Audit Trail{% endblock %}

{% block content %}
<div class="audit-page">
    <h1 class="page-title">Audit Trail</h1>

    <!-- Filters -->
    <div class="filter-bar">
        <select name="identity" class="form-select"
                hx-get="/partials/audit-filtered"
                hx-trigger="change"
                hx-target="#audit-results"
                hx-include=".filter-bar"
                hx-swap="innerHTML">
            <option value="">All Identities</option>
            {% for ident in identities %}
            <option value="{{ ident }}" {% if filters.identity == ident %}selected{% endif %}>{{ ident }}</option>
            {% endfor %}
        </select>

        <select name="category" class="form-select"
                hx-get="/partials/audit-filtered"
                hx-trigger="change"
                hx-target="#audit-results"
                hx-include=".filter-bar"
                hx-swap="innerHTML">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if filters.category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>

        <select name="action" class="form-select"
                hx-get="/partials/audit-filtered"
                hx-trigger="change"
                hx-target="#audit-results"
                hx-include=".filter-bar"
                hx-swap="innerHTML">
            <option value="">All Actions</option>
            {% for act in actions %}
            <option value="{{ act }}" {% if filters.action == act %}selected{% endif %}>{{ act }}</option>
            {% endfor %}
        </select>

        <select name="hours" class="form-select"
                hx-get="/partials/audit-filtered"
                hx-trigger="change"
                hx-target="#audit-results"
                hx-include=".filter-bar"
                hx-swap="innerHTML">
            <option value="1" {% if filters.hours == 1 %}selected{% endif %}>Last hour</option>
            <option value="6" {% if filters.hours == 6 %}selected{% endif %}>Last 6 hours</option>
            <option value="24" {% if filters.hours == 24 %}selected{% endif %}>Last 24 hours</option>
            <option value="168" {% if filters.hours == 168 %}selected{% endif %}>Last 7 days</option>
            <option value="720" {% if filters.hours == 720 %}selected{% endif %}>Last 30 days</option>
        </select>
    </div>

    <!-- Results -->
    <div id="audit-results">
        {% with entries=entries %}
        {% include "partials/audit_table.html" %}
        {% endwith %}
    </div>
</div>
{% endblock %}
