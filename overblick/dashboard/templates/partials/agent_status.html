{% if agent_rows %}
<div class="agent-grid">
    {% for agent in agent_rows %}
    <div class="agent-card">
        <div class="agent-card-header">
            <span class="status-dot status-{{ agent.state }}" aria-hidden="true"></span>
            <span class="agent-card-name">{{ agent.agent_name }}</span>
            {% if agent.restart_count > 0 %}
            <span class="restart-badge">{{ agent.restart_count }}x</span>
            {% endif %}
        </div>
        <div class="agent-card-meta">
            <span class="meta-item">
                <span class="meta-label">Identity</span>
                <a href="/agent/{{ agent.identity_ref }}">{{ agent.identity_name }}</a>
            </span>
            <span class="meta-item">
                <span class="meta-label">PID</span>
                <span class="mono">{{ agent.pid or 'â€”' }}</span>
            </span>
        </div>
        <div class="agent-card-meta">
            <span class="meta-item">
                <span class="meta-label">Uptime</span>
                {{ _format_uptime(agent.uptime) }}
            </span>
            <span class="meta-item">
                <span class="meta-label">State</span>
                <span class="state-text-{{ agent.state }}">{{ agent.state }}</span>
            </span>
        </div>
        {% if agent.last_action %}
        <div class="agent-card-action {% if not agent.last_action.success %}agent-card-action-fail{% endif %}">
            {{ agent.last_action.action }}
            {% if not agent.last_action.success %}
            <span class="status-badge status-stopped">FAIL</span>
            {% endif %}
        </div>
        {% endif %}
        {% if supervisor_running is defined and supervisor_running %}
        <div class="agent-card-actions">
            {% if agent.can_start %}
            <button class="btn btn-agent-start btn-sm"
                    hx-post="/agent/{{ agent.identity_ref }}/{{ agent.plugin }}/start"
                    hx-target="#agent-status-container"
                    hx-swap="innerHTML"
                    aria-label="Start {{ agent.agent_name }}">Start</button>
            {% endif %}
            {% if agent.can_stop %}
            <button class="btn btn-agent-stop btn-sm"
                    hx-post="/agent/{{ agent.identity_ref }}/{{ agent.plugin }}/stop"
                    hx-target="#agent-status-container"
                    hx-swap="innerHTML"
                    hx-confirm="Stop {{ agent.agent_name }} ({{ agent.identity_name }})?"
                    aria-label="Stop {{ agent.agent_name }}">Stop</button>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% elif supervisor_running is defined and not supervisor_running %}
<div class="empty-state">
    <p>Supervisor is offline. Start it to see agent status.</p>
</div>
{% else %}
<div class="empty-state">
    <p>No agents configured.</p>
</div>
{% endif %}
