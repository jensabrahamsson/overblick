{% if entries %}
<table class="audit-table">
    <thead>
        <tr>
            <th scope="col">Time</th>
            <th scope="col">Identity</th>
            <th scope="col">Action</th>
            <th scope="col">Category</th>
            <th scope="col">Plugin</th>
            <th scope="col">Duration</th>
            <th scope="col">Status</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for entry in entries %}
        <tr class="audit-row {% if not entry.success %}audit-row-error{% endif %}">
            <td class="mono audit-time">{{ entry.timestamp|epoch_to_datetime }}</td>
            <td>{{ entry.identity }}</td>
            <td>{{ entry.action }}</td>
            <td><span class="tag tag-sm">{{ entry.category }}</span></td>
            <td>{{ entry.plugin or '—' }}</td>
            <td class="mono">
                {% if entry.duration_ms is not none %}
                    {% if entry.duration_ms >= 1000 %}{{ "%.1f"|format(entry.duration_ms / 1000) }}s{% else %}{{ entry.duration_ms|int }}ms{% endif %}
                {% else %}
                    —
                {% endif %}
            </td>
            <td>
                {% if entry.success %}
                <span class="status-badge status-running">OK</span>
                {% else %}
                <span class="status-badge status-stopped">FAIL</span>
                {% endif %}
            </td>
            <td>
                {% if entry.error or entry.details %}
                <button class="btn-expand" aria-label="Show details" aria-expanded="false">&#9660;</button>
                {% endif %}
            </td>
        </tr>
        {% if entry.error or entry.details %}
        <tr class="audit-detail-row" hidden>
            <td colspan="8">
                <div class="audit-detail">
                    {% if entry.error %}
                    <div class="audit-detail-error">
                        <strong>Error:</strong> {{ entry.error }}
                    </div>
                    {% endif %}
                    {% if entry.details %}
                    <div class="audit-detail-json">
                        <strong>Details:</strong>
                        <pre class="mono">{{ entry.details | tojson(indent=2) if entry.details is mapping else entry.details }}</pre>
                    </div>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>

{% else %}
<div class="empty-state">
    <p>No audit entries found.</p>
</div>
{% endif %}
